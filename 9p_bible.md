# The Nine Panels Bible üôè

Notes, coding, style guide, architecture notes.

### Code Styling:

### Exception Handling:

All exceptions defined in the code must be of a custom type and inherit from `NinePanelsBaseException`.

`NinePanelsBaseException` handles all error logging, and ensures all errors contain a `detail` property.

`detail` is the human readbale, user friendly error message. `context_msg` provides space for a more technical description. `context_data` kwargs accept key value pairs of data relevant to the error.

At the main.py api level, all customer errors propgated up must be then wrapped finally in a `fastapi.HTTPException` with the `detail` param passed from the custom exception:

```
try:
    resp = update_foo()
except errors.FooNotUpdated as e:
    raise HTTPException(status=400, detail=e.detail)
```

### API Design:

#### Wrapped Responses

All responses, apart from those listed below, are intercepted by a middleware `ResponseWrapperMiddleware` that wraps the response in a standard object `.pydmodels.WrappedResponse`

Exceptions to wrapped responses:

- /docs
- /openapi.json
- /redoc
- /token

`/token` is not wrapped so as to enable swagger docs to authenticate. Clients must be aware of this exception to respnse wrapping.

### Logging and Monitoring:

Log messages are of a standard schema defined in `.pydmodels.LogMessage`. All calls to `logging` shoudl utilise the LogMessage schema.

Timing and performance monitoring uses a `Monitor` instance. Monitor instances have a `name` param on instantiation and simple `start` and `stop` methods. They have a `report` method which returns their current state.

Monitor instances are generated by a `MonitorFactory` which ensures only one instance of a monitor for a given `name` can exist and enables reporting on all monitor instances in memory. `MonitorFactory` is instantiated in `.config` and then can be imported to any file needing timing.

All purpose route timing is provided by a custom middleware instance called `TimingMiddleware`.

### Testing:

### Documentation:

#### API Docs

Published doc style will be redoc.